#!/usr/bin/env sh

# Fail fast
set -e

ENV_FILE=".env.local"

if [ ! -f "$ENV_FILE" ]; then
  echo "❌ $ENV_FILE not found"
  exit 1
fi

# Load .env.local safely
while IFS= read -r line || [ -n "$line" ]; do
  # Skip empty lines and comments
  case "$line" in
    "" | \#*) continue ;;
  esac

  # Only allow KEY=VALUE assignments
  case "$line" in
    [A-Za-z_][A-Za-z0-9_]*=*)
      # Split into key and value
      key=$(echo "$line" | cut -d '=' -f 1)
      # Extract value and strip leading/trailing double quotes
      value=$(echo "$line" | cut -d '=' -f 2- | sed -e 's/^"//' -e 's/"$//')

      # Export the cleaned version
      export "$key"="$value"
      ;;
    *)
      echo "⚠️  Ignoring invalid line in $ENV_FILE: $line"
      ;;
  esac
done < "$ENV_FILE"

echo "✅ Loaded environment from $ENV_FILE (quotes stripped)"
